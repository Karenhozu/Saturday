<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com">
    <link rel="stylesheet" href="./login.css">
</head>
<header>
    <div class="container-logo">
        <figure>
            <img src="../imgs/saturday-logo.png" alt="">
        </figure>
    </div>
</header>

<body>
    <section class="container container-login">
        <div class="form-text-container">
            <div class="container-fluid container-form">
                <h1>Iniciar <b>sesión</b></h1>
                <div class="form-content">
                    <form id="form" novalidate>
                        <div class="input-group">
                            <div class="mb-3 input-field">
                                <label for="email" class="form-label">Tu dirección de e-mail</label>
                                <input type="email" class="form-control" id="email" placeholder="Correo electrónico"
                                    required>
                                <span class="error"></span>
                            </div>
                            <div class="mb-3 input-field custom-date-wrapper">
                                <label for="password" class="form-label">Ingresa la contraseña</label>
                                <input type="password" class="form-control" id="password" placeholder="Contraseña"
                                    required>
                                <span class="error"></span>
                            </div>
                            <div class="d-grid gap-2 btn-form">
                                <!-- <a href="#" target="_blank">¿Olvidaste tu contraseña?</a> -->
                                <button type="submit" class="btn" id="btn-form">Iniciar sesión
                                    <svg viewBox="0 0 20 20" fill="currentColor" width="20" height="20"
                                        aria-hidden="true"
                                        class="icon_e634ab32bf rightIcon_8370ecdf48 noFocusStyle_b51f6a8a28"
                                        data-testid="icon" data-vibe="Icon">
                                        <path
                                            d="M2.24999 10.071C2.24999 9.65683 2.58578 9.32104 2.99999 9.32104L15.3315 9.32105L10.7031 4.69273C10.4103 4.39983 10.4103 3.92496 10.7031 3.63207C10.996 3.33917 11.4709 3.33917 11.7638 3.63207L17.6725 9.54071C17.9653 9.83361 17.9653 10.3085 17.6725 10.6014L11.7638 16.51C11.4709 16.8029 10.996 16.8029 10.7031 16.51C10.4103 16.2171 10.4103 15.7423 10.7031 15.4494L15.3315 10.821L2.99999 10.821C2.58578 10.821 2.24999 10.4853 2.24999 10.071Z"
                                            fill="currentColor" fill-rule="evenodd" clip-rule="evenodd"></path>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </form>
                </div>

            </div>
        </div>
    </section>

    <script>
        const form = document.getElementById("form");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const email = document.getElementById("email").value.trim();
            const password = document.getElementById("password").value.trim();


            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;


            if (!email || !password) {
                alert("Por favor llena todos los campos");
                return;
            }

            if (!emailRegex.test(email)) {
                alert("Ingresa un correo válido");
                return;
            }

            if (password.length < 8) {
                alert("La contraseña debe tener al menos 8 caracteres");
                return;
            }

            try {
                const res = await fetch("http://localhost:3001/api/users/login", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include", // mantener sesión
                    body: JSON.stringify({ email, password })
                });

                const data = await res.json();

                if (res.ok) {
                    alert("✅ Sesión iniciada correctamente");
                    // Redirigir al panel
                    window.location.href = "panel.html";
                } else {
                    alert(data.message || "Error en las credenciales");
                }
            } catch (error) {
                console.error("Error en login:", error);
                alert("Error de conexión con el servidor");
            }
        });


        async function logout() {
            await fetch("http://localhost:3001/api/users/logout", {
                method: "POST",
                credentials: "include"
            });
            localStorage.removeItem("user");
            window.location.href = "login.html";
        }

        const btnLogout = document.querySelector('.logout-btn')

        btnLogout.addEventListener('click', (e) => {
            e.preventDefault()
            logout()
        });

    </script>

</body>

</html>